# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  commons: ../common.yml
  actorCommons: ../actors/common.yml
  containerCommons: ../containers/common.yml

types:
  Build:
    properties:
      id: uuid
      name: string
      created_at: commons.Timestamp
      content_length:
        docs: Unsigned 64 bit integer.
        type: long
      tags:
        docs: Tags of this build
        type: map<string, string>
      runtime: optional<Runtime>

  Kind:
    enum:
      - value: docker_image
        docs: Docker image archive generated by `docker save`.
      - value: oci_bundle
        docs: OCI-compliant bundle.
      - value: javascript
        docs: |
          **Deprecated**
          A JavaScript file.

  Compression:
    enum:
      - value: none
        docs: None compression.
      - value: lz4
        docs: LZ4 compression. Use the minimum compression level.

  Runtime:
    properties:
      container: optional<RuntimeContainer>
      actor: optional<RuntimeActor>
  
  RuntimeContainer:
    properties:
      # arguments: optional<list<string>>
      environment: optional<map<string, string>>
      network_mode: optional<NetworkMode>
      ports: optional<map<string, PortRequest>>

  RuntimeActor:
    properties:
      # arguments: optional<list<string>>
      environment: optional<map<string, string>>
      network_mode: optional<NetworkMode>
      ports: optional<map<string, PortRequest>>
      resources: Resources
      slots: integer

  PortProtocol:
    enum:
      - http
      - https
      - tcp
      - tcp_tls
      - udp

  PortRouting:
    properties:
      guard: optional<GuardRouting>
      host: optional<HostRouting>

  GuardRouting:
    properties: {}

  HostRouting:
    properties: {}

  PortRequest:
    properties:
      protocol: PortProtocol
      internal_port: optional<integer>
      routing: optional<PortRouting>
  
  Resources:
    properties:
      cpu:
        docs: |
          The number of CPU cores in millicores, or 1/1000 of a core. For example,
          1/8 of a core would be 125 millicores, and 1 core would be 1000
          millicores.
        type: integer
      memory:
        docs: The amount of memory in mebibytes
        type: integer

  NetworkMode:
    enum:
      - bridge
      - host
