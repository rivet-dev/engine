# State

Actor data is isolated to this actor and cannot be accessed from other actors.

Actor state provides the best of both worlds: it's stored in-memory and persisted automatically. This lets you work with the data without added latency while still being able to survive crashes & upgrades.

There are two ways of storing actor data:

- **Native state** data is the most common persistence mechanism. State is a native JavaScript object stored in-memory.
- **Key-Value (KV)** data is used when dealing with lager datasets specific to this actor.

## Native state

State is a native JavaScript object stored in-memory on `this.state`. This makes building realtime & stateful applications as simple as dealing with JavaScript objects.

### State type

Actor states can be typed in TypeScript using the first generic argument on `Actor<State>`. For example:

```typescript
interface State {
    count: 0;
}

class Counter extends Actor<State> {
    // ...
}
```

### Initializing state

Each requires an `initializeState` method. This is only called once when the actor is created.

For example:

```typescript
interface State {
    count: 0;
}

class Counter extends Actor<State> {
    initializeState() {
        return { count: 0 };
    }
}
```

### State saves

Rivet automatically handles persisting state transparently to recover from a crash or upgrade. This happens at the end of every function call if the state has changed.

In the rare occasion you need to force a state change mid-function call, you can use `forceSaveState`. This should only be used if your function makes an important state change that needs to be persisted before the function exits in case of a crash.

### Valid data types

Only JSON-serializable types can be stored in state. State is persisted under the hood in a compact, binary format.

### Limitations

State is constrained to the available memory. For larger datasets, use KV.

## Key-Value (KV)

### Operations

TODO

### Sorted keys

TODO

### Cookbook

TODO

#### Document store

TODO

#### Indexes

TODO

#### Queues

TODO
